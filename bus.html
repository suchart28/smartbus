<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Bus Location Sender</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        font-family: sans-serif;
        background: #003049;
        color: #fff;
        margin: 0;
        padding: 0;
        text-align: center;
    }

    h1 {
        font-size: 2.4rem;
        font-weight: bold;
        margin-top: 25px;
        color: #ffdd57;
    }

    input {
        width: 80%;
        padding: 15px;
        font-size: 2rem;
        border-radius: 12px;
        border: none;
        margin: 15px 0;
        text-align: center;
    }

    .status {
        font-size: 1.8rem;
        margin: 15px 0;
        padding: 10px;
        background: #1a759f;
        border-radius: 10px;
        display: inline-block;
        min-width: 80%;
    }

    .coords {
        font-size: 1.6rem;
        margin: 10px 0;
    }

    button {
        width: 90%;
        padding: 20px;
        font-size: 2.2rem;
        border-radius: 15px;
        background: #2a9d8f;
        color: #fff;
        border: none;
        margin-top: 20px;
        cursor: pointer;
        font-weight: bold;
    }

    button:active {
        background: #21867a;
    }
</style>

</head>
<body>

<h1>üöç ‡∏™‡πà‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏ñ‡∏ö‡∏±‡∏™</h1>

<input type="text" id="busId" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏£‡∏ñ‡∏ö‡∏±‡∏™ ‡πÄ‡∏ä‡πà‡∏ô 23">

<div class="status" id="statusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...</div>
<div class="coords" id="coordsText">-</div>

<button onclick="sendLocation()">‡∏™‡πà‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</button>

<script>
const API_URL = "https://script.google.com/macros/s/XXXXXXX/exec"; // <--- ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

// ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏´‡∏±‡∏™‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
document.getElementById("busId").value = localStorage.getItem("busId") || "";

function sendLocation() {
    const busId = document.getElementById("busId").value.trim();

    if (!busId) {
        document.getElementById("statusText").textContent = "‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏£‡∏ñ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á";
        return;
    }

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏°‡πà
    localStorage.setItem("busId", busId);

    navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        document.getElementById("coordsText").textContent =
            `üåè ${lat.toFixed(5)}, ${lon.toFixed(5)}`;

        fetch(`${API_URL}?bus=${busId}&lat=${lat}&lon=${lon}`)
            .then(() => {
                document.getElementById("statusText").textContent = "‚úÖ ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
            })
            .catch(() => {
                document.getElementById("statusText").textContent = "‚ùå ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
            });

    }, () => {
        document.getElementById("statusText").textContent = "‚ö†Ô∏è ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡πà‡∏≠‡∏ô";
    });
}

// ‡∏™‡πà‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 2 ‡∏ô‡∏≤‡∏ó‡∏µ
setInterval(sendLocation, 2 * 60 * 1000);

// ‡∏™‡πà‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
sendLocation();
</script>

</body>
</html>
