<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Bus Location Sender</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        font-family: sans-serif;
        background: #003049;
        color: #fff;
        margin: 0;
        padding: 0;
        text-align: center;
    }

    h1 {
        font-size: 2.4rem;
        font-weight: bold;
        margin-top: 25px;
        color: #ffdd57;
    }

    .input-box {
        margin-top: 15px;
    }

    input {
        width: 80%;
        padding: 15px;
        font-size: 1.8rem;
        border-radius: 12px;
        border: none;
        text-align: center;
        margin-bottom: 15px;
    }

    .status {
        font-size: 1.8rem;
        margin: 15px 0;
        padding: 10px;
        background: #1a759f;
        border-radius: 10px;
        display: inline-block;
        min-width: 80%;
    }

    .coords {
        font-size: 1.6rem;
        margin: 10px 0;
    }

    .timer {
        font-size: 2rem;
        margin-top: 10px;
        color: #ffb703;
    }

    button {
        width: 90%;
        padding: 20px;
        font-size: 2.2rem;
        border-radius: 15px;
        background: #2a9d8f;
        color: #fff;
        border: none;
        margin-top: 20px;
        cursor: pointer;
        font-weight: bold;
    }

    button:active {
        background: #21867a;
    }
</style>

</head>
<body>

<h1>üöç ‡∏™‡πà‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏ñ‡∏ö‡∏±‡∏™</h1>

<div class="input-box">
    <input id="busId" type="text" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏£‡∏ñ‡∏ö‡∏±‡∏™ ‡πÄ‡∏ä‡πà‡∏ô B12">
</div>

<div class="status" id="statusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...</div>
<div class="coords" id="coordsText">-</div>

<div class="timer">‡∏™‡πà‡∏á‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÉ‡∏ô <span id="countdown">120</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</div>

<button onclick="manualSend()">‡∏™‡πà‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</button>

<script>
const API_URL = "https://script.google.com/macros/s/XXXXXXX/exec"; // <--- ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
let countdown = 120;
let timer;

function startCountdown() {
    clearInterval(timer);
    countdown = 120;
    document.getElementById("countdown").textContent = countdown;

    timer = setInterval(() => {
        countdown--;
        document.getElementById("countdown").textContent = countdown;
        if (countdown <= 0) {
            sendLocation();
        }
    }, 1000);
}

function manualSend() {
    sendLocation(true);
}

function sendLocation(manual = false) {
    const busId = document.getElementById("busId").value.trim();
    if (!busId) {
        document.getElementById("statusText").textContent = "‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏£‡∏ñ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á";
        return;
    }

    navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        document.getElementById("coordsText").textContent = 
            `üåè ${lat.toFixed(5)}, ${lon.toFixed(5)}`;

        fetch(`${API_URL}?bus=${busId}&lat=${lat}&lon=${lon}`)
            .then(() => {
                document.getElementById("statusText").textContent = 
                    manual ? "‚úÖ ‡∏™‡πà‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß" : "‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
                startCountdown();
            })
            .catch(() => {
                document.getElementById("statusText").textContent = "‚ùå ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
            });

    }, () => {
        document.getElementById("statusText").textContent = "‚ö†Ô∏è ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡πà‡∏≠‡∏ô";
    });
}

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πà‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å
sendLocation();
startCountdown();
</script>

</body>
</html>
